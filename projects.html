<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Projets - Knight Peterson Jean-Baptiste</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<nav class="navbar">
  <a href="index.html">KPJB</a>
</nav>

<main>

<section class="add-project-section">
  <h2>Ajouter un projet</h2>
  <form id="addProjectForm">
    <input type="text" name="title" placeholder="Titre" required />
    <select name="category" required>
      <option value="data-science">Data Science</option>
      <option value="machine-learning">Machine Learning</option>
      <option value="statistics">Statistiques</option>
      <option value="web-development">Web</option>
      <option value="research">Recherche</option>
      <option value="other">Autre</option>
    </select>
    <textarea name="description" placeholder="Description" required></textarea>
    <input type="text" name="technologies" placeholder="Technologies" />
    <input type="date" name="date" />
    <input type="url" name="link" placeholder="Lien" />
    <input type="file" name="image" id="project-image" />
    <button type="submit">Ajouter</button>
  </form>
</section>

<section class="projects-section">
  <h2>Mes projets</h2>
  <div class="projects-filters">
    <button class="filter-btn active" data-filter="all">Tous</button>
    <button class="filter-btn" data-filter="data-science">Data Science</button>
    <button class="filter-btn" data-filter="machine-learning">ML</button>
    <button class="filter-btn" data-filter="statistics">Stats</button>
    <button class="filter-btn" data-filter="web-development">Web</button>
    <button class="filter-btn" data-filter="research">Recherche</button>
  </div>

  <div id="projectsGrid" class="projects-grid">

    <!-- Projet statique -->
    <div class="project-card" data-category="data-science">
      <h3>Multi-omic Survival Analysis</h3>
      <p>Analyse de survie TCGA</p>
      <div class="project-links">
        <a href="#">Voir</a>
        <button class="project-delete-btn">Supprimer</button>
      </div>
    </div>

  </div>

  <div id="noProjects" style="display:none;">
    <p>Aucun projet trouv√©</p>
  </div>

</section>
</main>

<script>
const addProjectForm = document.getElementById("addProjectForm");
const projectsGrid = document.getElementById("projectsGrid");
let projects = [];

/* ---------- INIT STATIC PROJECTS ---------- */
document.querySelectorAll(".project-card").forEach((card, index) => {
  card.dataset.id = "static-" + (index + 1);
});

/* ---------- LOAD / SAVE ---------- */
function loadProjects() {
  const saved = localStorage.getItem("projects");
  if (saved) {
    projects = JSON.parse(saved);
    renderProjects();
  }
}

function saveProjects() {
  localStorage.setItem("projects", JSON.stringify(projects));
}

/* ---------- RENDER ---------- */
function renderProjects(filter = "all") {

  // Clear dynamic cards
  document.querySelectorAll(".project-card.dynamic").forEach(c => c.remove());

  const filtered = filter === "all"
    ? projects
    : projects.filter(p => p.category === filter);

  filtered.forEach(project => {
    const card = createProjectCard(project);
    projectsGrid.appendChild(card);
  });

  // Handle static filter visibility
  document.querySelectorAll(".project-card:not(.dynamic)").forEach(card => {
    card.style.display =
      filter === "all" || card.dataset.category === filter ? "block" : "none";
  });

  const visible = projectsGrid.querySelectorAll(".project-card:not([style*='none'])");
  document.getElementById("noProjects").style.display =
    visible.length === 0 ? "block" : "none";
}

/* ---------- CREATE CARD ---------- */
function createProjectCard(project) {
  const card = document.createElement("div");
  card.className = "project-card dynamic";
  card.dataset.id = project.id;
  card.dataset.category = project.category;

  card.innerHTML = `
    <h3>${project.title}</h3>
    <p>${project.description}</p>
    <small>${project.date ? new Date(project.date).getFullYear() : ""}</small>
    <div class="project-links">
      ${project.link ? `<a href="${project.link}" target="_blank">Voir</a>` : ""}
      <button class="project-delete-btn" data-id="${project.id}">Supprimer</button>
    </div>
  `;

  return card;
}

/* ---------- ADD PROJECT ---------- */
addProjectForm.addEventListener("submit", function(e) {
  e.preventDefault();
  const fd = new FormData(this);

  const project = {
    id: Date.now().toString(),
    title: fd.get("title"),
    category: fd.get("category"),
    description: fd.get("description"),
    technologies: fd.get("technologies"),
    date: fd.get("date"),
    link: fd.get("link")
  };

  projects.push(project);
  saveProjects();
  renderProjects();

  this.reset();
});

/* ---------- DELETE PROJECT ---------- */
function deleteProject(projectId) {
  if (!confirm("Supprimer ce projet ?")) return;

  projects = projects.filter(p => p.id !== projectId);
  saveProjects();

  const card = document.querySelector(`.project-card[data-id="${projectId}"]`);
  if (card) card.remove();

  renderProjects();
}

/* ---------- EVENTS ---------- */
projectsGrid.addEventListener("click", function(e) {
  if (e.target.classList.contains("project-delete-btn")) {
    const id = e.target.dataset.id || e.target.closest(".project-card").dataset.id;
    deleteProject(id);
  }
});

document.querySelectorAll(".filter-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    renderProjects(this.dataset.filter);
  });
});

/* ---------- START ---------- */
loadProjects();
renderProjects();
</script>

</body>
</html>